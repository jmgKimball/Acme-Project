<template>
	<template if:true={showSpinner}>
		<lightning-spinner alternative-text="Loading"></lightning-spinner>
	</template>

	<template if:true={hasServiceError}>
		<div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
			<h2>{serviceError}</h2>
		</div>
	</template>
	<template if:true={isEdit}>
		<div class="khc-lookup">

			<div onkeypress={handlePress}>
				<lightning-input type="search"
				                 class="medication-search"
				                 id="medication-search"
				                 label={medicationNameLabel}
								 onchange={onSearchChange}
								  required>
				</lightning-input>
			</div>
			<span>
				<button class="slds-button slds-button-neutral slds-button_stretch slds-p-vertical_x-small khc-search-button"
				        onclick={handleMedicationListClick}>Search
				</button>
			</span>
			<template if:true={hasMedicationError}>
				<div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
					<h2>{medicationError}</h2>
				</div>
			</template>
			<template if:true={showDruglist}>

				<div class="slds-form-element">
					<div class="slds-form-element__control">
						<div class="slds-combobox_container">
							<div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open" aria-expanded="true" aria-haspopup="listbox" role="combobox">
								<div id="listbox-id-4" class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox">
									<ul class="slds-listbox slds-listbox_vertical" role="presentation">
										<li role="presentation" class="slds-listbox__item">
											<div aria-selected="true" id="option0" class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_term slds-has-focus" role="option">
												<span class="slds-media__body">
												<span class="slds-listbox__option-text slds-listbox__option-text_entity">Select Medication</span>
												</span>
											</div>
										</li>
										<template for:each={drugList} for:item="drug">
											<li role="presentation" class="slds-listbox__item" key={drug.id}>
												<div id={drug.id} class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta" role="option">
													<span class="slds-media__figure slds-listbox__option-icon">
													<span class="slds-icon_container slds-icon-custom-custom91">
														<svg class="slds-icon slds-icon_small" aria-hidden="true">
															<use xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#custom91"></use>
														</svg>
													</span>
													</span>
													<span class="slds-media__body">
													<span class="slds-listbox__option-text slds-listbox__option-text_entity">
													</span>
													<a key={drug.id} data-record-name={drug.title} data-drug-setid={drug.setid} onclick={selectDrug}> {drug.title} </a>
													</span>
												</div>
											</li>
										</template>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</template>
		</div>
	</template>
	<template if:true={isExisting}>
		<div class="slds-form-element">
			<label class="slds-form-element__label" for="default-medication">{medicationNameLabel}</label>
			<div class="slds-form-element__control">
				<div class="slds-combobox_container slds-has-selection">
					<div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" aria-expanded="false"
					     aria-haspopup="listbox" role="combobox">
						<div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_left-right"
						     role="none">
							<lightning-icon icon-name="custom:custom3"
							                class="slds-combobox__input-entity-icon"></lightning-icon>
							<input type="text"
							       class="slds-input slds-combobox__input slds-combobox__input-value"
							       id="default-medication"
							       placeholder="Select an Option" readonly
							       value={medicationRecord.Name}/>
							<lightning-button-icon
									variant="bare"
									icon-name="utility:close"
							        class=" slds-input__icon slds-input__icon_right allow-pointer-events"
									onclick={clearMedication}></lightning-button-icon>
						</div>
					</div>
				</div>
			</div>
		</div>
	</template>
</template>